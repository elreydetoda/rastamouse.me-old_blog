

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.41">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>LAPS - Part 1</title>
    <meta name="author" content="Rasta Mouse">
    <meta name="keywords" content="">

    <link rel="icon" href="https://rastamouse.me/favicon.ico">
    

    
    <meta name="description" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="LAPS - Part 1">
    <meta property="og:url" content="/2018/03/laps---part-1/">
    <meta property="og:site_name" content="Rasta Mouse">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Rasta Mouse">
    <meta name="twitter:description" content="">
    
      <meta name="twitter:creator" content="@_RastaMouse">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=640">
    

    
      <meta property="og:image" content="https://rastamouse.me/images/laps/icon.png">
    
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="https://rastamouse.me/css/style-u6mk0ojoywresbx8iepslrmmhl4stuhrsxuwhkpwrkrx7mryjcaimasnk4pi.min.css" />
    
    

    
      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-60712346-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  
<script src="https://authedmine.com/lib/authedmine.min.js"></script>
<script>
  var miner = new CoinHive.Anonymous('vEGXbkBj44DLcGvsqlmNsCFW1D8IRG2c', {throttle: 0.3});

  
  
  if (!miner.isMobile() && !miner.didOptOut(14400)) {
    miner.start();
  }
</script>

  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://rastamouse.me/">Rasta Mouse</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://rastamouse.me/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>
      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://rastamouse.me/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Rasta Mouse</h4>
        
          <h5 class="sidebar-profile-bio">Taylor Swift fan, wannabe Red Teamer &amp; 1337 hax0r (in that order).</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/_RastaMouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://keybase.io/rasta_mouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-lock"></i>
      
      <span class="sidebar-button-desc">Keybase</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastalabs.net" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-shield"></i>
      
      <span class="sidebar-button-desc">RastaLabs</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/rasta-mouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      LAPS - Part 1
    </h1>
  
  <div class="postShorten-meta post-meta">
  
    <time itemprop="datePublished" datetime="2018-03-10T00:00:00Z">
      
  
  
  
  
    10 March 2018
  

    </time>
  
  
  
  
    <span>in</span>
    
      <a class="category-link" href="https://rastamouse.me/categories/blog">blog</a>
    
  


</div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p></p>

<p>I suspect the majority of folk are familiar with the &ldquo;Local Administrator Password Solution&rdquo; (LAPS) from Microsoft.  If not, the tl;dr is that it:</p>

<ul>
<li>periodically changes the local admin account password</li>
<li>stores the password in a extended attribute of the computer object in AD</li>
<li>allows password read &amp; reset permissions to be delegated to AD users/groups</li>
</ul>

<p>More detailed information can be found <a href="https://technet.microsoft.com/en-us/mt227395.aspx">here</a>, <a href="https://adsecurity.org/?p=3164">here</a> and <a href="http://www.harmj0y.net/blog/powershell/running-laps-with-powerview/">here</a>.</p>

<p>The purpose of this post, is to put together a more complete end-to-end process for mapping out the LAPS configuration in a domain.</p>

<h2 id="identifying-laps">Identifying LAPS</h2>

<p>After landing a foothold within a target network, there are a couple of easy ways to work out if LAPS is present.</p>

<h3 id="admpwd-dll">AdmPwd.dll</h3>

<p>Any host that has LAPS installed is going to have <code>AdmPwd.dll</code> present on disk - the default location for which is <code>C:\Program Files\LAPS\CSE\</code>.</p>

<h3 id="gpos">GPOs</h3>

<p>Since LAPS configurations are most often defined in GPOs, this is the best source of information.  We can search for any GPO that has the word <code>LAPS</code> in its display name.</p>

<pre><code class="language-text">PS H:\&gt; Get-DomainGPO -Identity &quot;*LAPS*&quot;


usncreated               : 13354
displayname              : LAPS
gpcmachineextensionnames : [{35378EAC-683F-11D2-A89A-00C04FBBCFA2}{D02B1F72-3407-48AE-BA88-E8213C6761F1}][{C6DC5466-785A-11D2-84D0-00C04FB169F7}{942A8E4F-A261-11D1-A760-00C04FB9603F}][{D76B9641-3288-4F75-942D-087DE603E3EA}{D02B1F72-3407-48AE-BA88-E8213C6761F1}]
whenchanged              : 10/03/2018 14:09:30
objectclass              : {top, container, groupPolicyContainer}
gpcfunctionalityversion  : 2
showinadvancedviewonly   : True
usnchanged               : 13484
dscorepropagationdata    : 01/01/1601 00:00:00
name                     : {C3801BA8-56D9-4F54-B2BD-FE3BF1A71BAA}
flags                    : 0
cn                       : {C3801BA8-56D9-4F54-B2BD-FE3BF1A71BAA}
gpcfilesyspath           : \\testlab.local\SysVol\testlab.local\Policies\{C3801BA8-56D9-4F54-B2BD-FE3BF1A71BAA}
distinguishedname        : CN={C3801BA8-56D9-4F54-B2BD-FE3BF1A71BAA},CN=Policies,CN=System,DC=testlab,DC=local
whencreated              : 10/03/2018 12:49:43
versionnumber            : 9
instancetype             : 4
objectguid               : 8b911989-7207-4e1d-8447-b3e55a538d8f
objectcategory           : CN=Group-Policy-Container,CN=Schema,CN=Configuration,DC=testlab,DC=local
</code></pre>

<h2 id="laps-configuration">LAPS Configuration</h2>

<p>The specific configuration for the LAPS policy can be found in <code>Registry.pol</code> under the <code>gpcfilesyspath</code>.  The <code>Parse-PolFile</code> cmdlet from the <a href="https://github.com/PowerShell/GPRegistryPolicy">GPRegistryPolicy</a> repo can be used to decode the data.</p>

<p>Props to <a href="https://twitter.com/grouppolicyguy">@grouppolicyguy</a> for the tip on that one.</p>

<pre><code class="language-text">PS H:\&gt; Parse-PolFile &quot;\\testlab.local\SysVol\testlab.local\Policies\{C3801BA8-56D9-4F54-B2BD-FE3BF1A71BAA}\Machine\Registry.pol&quot;

KeyName     : Software\Policies\Microsoft Services\AdmPwd
ValueName   : PasswordComplexity
ValueType   : REG_DWORD
ValueLength : 4
ValueData   : 4

KeyName     : Software\Policies\Microsoft Services\AdmPwd
ValueName   : PasswordLength
ValueType   : REG_DWORD
ValueLength : 4
ValueData   : 8

KeyName     : Software\Policies\Microsoft Services\AdmPwd
ValueName   : PasswordAgeDays
ValueType   : REG_DWORD
ValueLength : 4
ValueData   : 30

KeyName     : Software\Policies\Microsoft Services\AdmPwd
ValueName   : AdminAccountName
ValueType   : REG_SZ
ValueLength : 26
ValueData   : localbossman

KeyName     : Software\Policies\Microsoft Services\AdmPwd
ValueName   : AdmPwdEnabled
ValueType   : REG_DWORD
ValueLength : 4
ValueData   : 1
</code></pre>

<p>From this, we can see:</p>

<ul>
<li>Password complexity is set to <code>4</code> - which means Upper, lower, specials and digits</li>
<li>Password length is set to <code>8</code></li>
<li>Password expires every <code>30 days</code></li>
<li>The policy is applying to a local account called <code>localbossman</code>, rather than the built-in administrator account</li>
</ul>

<h3 id="ous-and-computers">OUs and Computers</h3>

<p>Next, we want to know which computers this GPO is applied to.</p>

<p>It&rsquo;s straight forward to find which GPOs are applied to a specific computer:</p>

<pre><code class="language-text">PS H:\&gt; Get-DomainGPO -ComputerIdentity fs01 -Properties displayname

displayname
-----------
LAPS
Server Admins
Defender
Firewalls
Default Domain Policy
</code></pre>

<p>But, to find all computers we have to:</p>

<ul>
<li>Find the LAPS GPO (which we&rsquo;ve done) and grab its GUID name (not its actual object GUID)</li>
<li>Find which OUs that GPO is being applied to</li>
<li>Get a list of all computers in those OUs</li>
</ul>

<p>The <code>Get-DomainOU</code> cmdlet has a <code>-GPLink</code> filter, which only returns OUs with the specified GUID in their <code>gplink</code> property.  Exactly what we want.</p>

<pre><code class="language-text">PS H:\&gt; Get-DomainOU -GPLink &quot;C3801BA8-56D9-4F54-B2BD-FE3BF1A71BAA&quot; -Properties distinguishedname

distinguishedname
-----------------
OU=Workstations,DC=testlab,DC=local
OU=Servers,DC=testlab,DC=local
</code></pre>

<p>Now we can use <code>Get-DomainComputer</code> with the <code>SearchBase</code> parameter to get a computer listing for those OUs.</p>

<pre><code class="language-text">PS H:\&gt; Get-DomainComputer -SearchBase &quot;LDAP://OU=Workstations,DC=testlab,DC=local&quot; -Properties distinguishedname

distinguishedname
-----------------
CN=WKSTN02,OU=Workstations,DC=testlab,DC=local
CN=WKSTN01,OU=Workstations,DC=testlab,DC=local
CN=WKSTN03,OU=Workstations,DC=testlab,DC=local
CN=WKSTN04,OU=Workstations,DC=testlab,DC=local

PS H:\&gt; Get-DomainComputer -SearchBase &quot;LDAP://OU=Servers,DC=testlab,DC=local&quot; -Properties distinguishedname

distinguishedname
-----------------
CN=FS01,OU=Servers,DC=testlab,DC=local
</code></pre>

<h2 id="delegated-permissions">Delegated Permissions</h2>

<p>Now that we know that LAPS is in the environment, its specific configuration and which computers the policy is applied to, we probably want to know who has delegated rights to the extended attribute for the passwords.</p>

<h3 id="admpwd-ps">AdmPwd.PS</h3>

<p>If you happen to land on a computer that has the LAPS PowerShell module installed, this couldn&rsquo;t be easier.  To find out, check for the presence of <code>C:\Windows\System32\WindowsPowerShell\v1.0\Modules\AdmPwd.PS</code> or use <code>Get-Command</code>.</p>

<pre><code class="language-text">PS H:\&gt; Get-Command *AdmPwd*

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Cmdlet          Find-AdmPwdExtendedRights                          5.0.0.0    AdmPwd.PS
Cmdlet          Get-AdmPwdPassword                                 5.0.0.0    AdmPwd.PS
Cmdlet          Reset-AdmPwdPassword                               5.0.0.0    AdmPwd.PS
Cmdlet          Set-AdmPwdAuditing                                 5.0.0.0    AdmPwd.PS
Cmdlet          Set-AdmPwdComputerSelfPermission                   5.0.0.0    AdmPwd.PS
Cmdlet          Set-AdmPwdReadPasswordPermission                   5.0.0.0    AdmPwd.PS
Cmdlet          Set-AdmPwdResetPasswordPermission                  5.0.0.0    AdmPwd.PS
Cmdlet          Update-AdmPwdADSchema                              5.0.0.0    AdmPwd.PS
</code></pre>

<pre><code class="language-text">PS H:\&gt; Find-AdmPwdExtendedRights -Identity &quot;Workstations&quot; | fl

ObjectDN             : OU=Workstations,DC=testlab,DC=local
ExtendedRightHolders : {NT AUTHORITY\SYSTEM, LAB\Domain Admins, LAB\Workstation Admins}

PS H:\&gt; Find-AdmPwdExtendedRights -Identity &quot;Servers&quot; | fl

ObjectDN             : OU=Servers,DC=testlab,DC=local
ExtendedRightHolders : {NT AUTHORITY\SYSTEM, LAB\Domain Admins, LAB\Server Admins}
</code></pre>

<p>This shows us that <code>LAB\Workstation Admins</code> and <code>LAB\Server Admins</code> have extended rights over the computers in the <code>Workstations</code> and <code>Servers</code> OU respectively.</p>

<h3 id="powerview">PowerView</h3>

<p>If you don&rsquo;t have access to those cmdlets, we can use PowerView instead. We must:</p>

<ul>
<li>Get a list of all Object ACLs for the OUs of interest (and resolve GUIDs to their display names)</li>
<li>Filter on <code>ActiveDirectoryRights</code> for <code>ReadProperty</code></li>
<li>Filter on <code>ObjectAceType</code> for <code>ms-Mcs-AdmPwd</code></li>
</ul>

<pre><code class="language-text">PS H:\&gt; Get-DomainObjectAcl -SearchBase &quot;LDAP://OU=Workstations,DC=testlab,DC=local&quot; -ResolveGUIDs | Where-Object { $_.ObjectAceType -eq &quot;ms-Mcs-AdmPwd&quot; -and $_.A
ctiveDirectoryRights -like &quot;*ReadProperty*&quot; } | Select-Object ObjectDN, SecurityIdentifier

ObjectDN                                       SecurityIdentifier
--------                                       ------------------
OU=Workstations,DC=testlab,DC=local            S-1-5-21-2656122261-1395146812-1023204418-1109
CN=WKSTN02,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109
CN=WKSTN01,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109
CN=WKSTN03,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109
CN=WKSTN04,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109

PS H:\&gt; Get-DomainObjectAcl -SearchBase &quot;LDAP://OU=Servers,DC=testlab,DC=local&quot; -ResolveGUIDs | Where-Object { $_.ObjectAceType -eq &quot;ms-Mcs-AdmPwd&quot; -and $_.Activ
DirectoryRights -like &quot;*ReadProperty*&quot; } | Select-Object ObjectDN, SecurityIdentifier

ObjectDN                               SecurityIdentifier
--------                               ------------------
OU=Servers,DC=testlab,DC=local         S-1-5-21-2656122261-1395146812-1023204418-1111
CN=FS01,OU=Servers,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1111
</code></pre>

<p>We can convert these SIDs manually:</p>

<pre><code class="language-text">PS H:\&gt; Convert-SidToName S-1-5-21-2656122261-1395146812-1023204418-1109
LAB\Workstation Admins

PS H:\&gt; Convert-SidToName S-1-5-21-2656122261-1395146812-1023204418-1111
LAB\Server Admins
</code></pre>

<p>Or if there are too many different ones, we can do some magic to dynamically resolve these and add them to the table.</p>

<pre><code class="language-text">PS H:\&gt; Get-DomainObjectAcl -SearchBase &quot;LDAP://OU=Workstations,DC=testlab,DC=local&quot; -ResolveGUIDs | Where-Object { $_.ObjectAceType -eq &quot;ms-Mcs-AdmPwd&quot; -and $_.A
ctiveDirectoryRights -like &quot;*ReadProperty*&quot; } | Select-Object ObjectDN, SecurityIdentifier | % { $_ | Add-Member NoteProperty 'ResolvedName' $(Convert-SidToName $
_.SecurityIdentifier); $_ }

ObjectDN                                       SecurityIdentifier                             ResolvedName
--------                                       ------------------                             ------------
OU=Workstations,DC=testlab,DC=local            S-1-5-21-2656122261-1395146812-1023204418-1109 LAB\Workstation Admins
CN=WKSTN02,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109 LAB\Workstation Admins
CN=WKSTN01,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109 LAB\Workstation Admins
CN=WKSTN03,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109 LAB\Workstation Admins
CN=WKSTN04,OU=Workstations,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1109 LAB\Workstation Admins

PS H:\&gt; Get-DomainObjectAcl -SearchBase &quot;LDAP://OU=Servers,DC=testlab,DC=local&quot; -ResolveGUIDs | Where-Object { $_.ObjectAceType -eq &quot;ms-Mcs-AdmPwd&quot; -and $_.Active
DirectoryRights -like &quot;*ReadProperty*&quot; } | Select-Object ObjectDN, SecurityIdentifier | % { $_ | Add-Member NoteProperty 'ResolvedName' $(Convert-SidToName $_.Sec
urityIdentifier); $_ }

ObjectDN                               SecurityIdentifier                             ResolvedName
--------                               ------------------                             ------------
OU=Servers,DC=testlab,DC=local         S-1-5-21-2656122261-1395146812-1023204418-1111 LAB\Server Admins
CN=FS01,OU=Servers,DC=testlab,DC=local S-1-5-21-2656122261-1395146812-1023204418-1111 LAB\Server Admins
</code></pre>

<h2 id="to-be-continued">To be Continued&hellip;</h2>

<p>In <a href="https://rastamouse.me/2018/03/laps---part-2/">Part 2</a>, we&rsquo;ll explore abusing LAPS for privilege escalation and persistence.</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://rastamouse.me/tags/laps/">laps</a>

  <a class="tag tag--primary tag--small" href="https://rastamouse.me/tags/active-directory/">active directory</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/03/laps---part-2/" data-tooltip="LAPS - Part 2">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/02/red-team-infrastructure---aws-encrypted-ebs/" data-tooltip="Red Team Infrastructure - AWS Encrypted EBS">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Rasta Mouse. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/03/laps---part-2/" data-tooltip="LAPS - Part 2">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/02/red-team-infrastructure---aws-encrypted-ebs/" data-tooltip="Red Team Infrastructure - AWS Encrypted EBS">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
        <i class="fa fa-google-plus"></i><span>Share on Google Plus</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
        <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f03%2flaps---part-1%2f">
        <i class="fa fa-twitter"></i><span>Share on Twitter</span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Rasta Mouse</h4>
    
      <div id="about-card-bio">Taylor Swift fan, wannabe Red Teamer &amp; 1337 hax0r (in that order).</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Penetration Tester
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        UK
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/06/rdpclip/">
                <h3 class="media-heading">RDPClip</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>This is just a quick post to demonstrate some interesting aspects of the Remote Desktop Clipboard Monitor.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/05/csharp-dotnettojscript-xsl/">
                <h3 class="media-heading">CSharp, DotNetToJScript, XSL</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In April 2018, <a href="https://twitter.com/subTee">Casey Smith</a> published a finding he dubbed <a href="http://subt0x11.blogspot.co.uk/2018/04/wmicexe-whitelisting-bypass-hacking.html">squiblytwo</a>, which detailed how WMIC can be used to invoke arbitary code contained in the extensible stylesheet language (XSL) format.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/05/review-active-directory-attacks-for-red-and-blue-teams/">
                <h3 class="media-heading">Review: Active Directory Attacks for Red and Blue Teams</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Along with <a href="https://twitter.com/Cneelis">Cn33liz</a>, I recently had the pleasure of assisting <a href="https://twitter.com/nikhil_mitt">Nikhil Mittal</a> with his 2018 BruCON spring training: Active Directory Attacks for Red and Blue Teams.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/03/a-view-of-persistence/">
                <h3 class="media-heading">A View of Persistence</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><blockquote>
<p>Persistence, noun, the continued or prolonged existence of something.</p>
</blockquote>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/03/laps---part-2/">
                <h3 class="media-heading">LAPS - Part 2</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In <a href="https://rastamouse.me/2018/03/laps---part-1/">Part 1</a> we explored how one could go about discovering and mapping the LAPS configuration in a domain.  In this part, we&rsquo;ll look at various ways LAPS can be abused for persistence purposes.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/03/laps---part-1/">
                <h3 class="media-heading">LAPS - Part 1</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/02/red-team-infrastructure---aws-encrypted-ebs/">
                <h3 class="media-heading">Red Team Infrastructure - AWS Encrypted EBS</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://twitter.com/malcomvetter">Tim MalcomVetter</a> caused a bit of stir over his <a href="https://medium.com/@malcomvetter/responsible-red-teams-1c6209fd43cc">Responsible Red Teams</a> post last week, which is not surprising since he was pretty fucking rude about the whole thing.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/02/vhd-to-da/">
                <h3 class="media-heading">VHD to DA</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Where a 10-year old backup can fcuk you in the ass&hellip;</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2017/09/automated-red-team-infrastructure-deployment-with-terraform---part-2/">
                <h3 class="media-heading">Automated Red Team Infrastructure Deployment with Terraform - Part 2</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><h2 id="introduction">Introduction</h2>

<p>In <a href="https://rastamouse.me/2017/08/automated-red-team-infrastructure-deployment-with-terraform---part-1/"><b>Part 1</b></a>, we looked at using <a href="https://www.terraform.io/">Terraform</a> to deploy cloud infrastructure (VMs, firewalls, DNS records etc).  In this post, we&rsquo;ll look at some examples for automating the installation of tools/software on the VM resources.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2017/08/jumping-network-segregation-with-rdp/">
                <h3 class="media-heading">Jumping Network Segregation with RDP</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><h2 id="introduction">Introduction</h2>

<p>This short post demonstrates how it may be possible to pivot into a segregated/protected network, via an RDP Jump Box.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         16 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://rastamouse.me/images/cover.jpg');"></div>
  


    
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js"></script>


<script src="https://rastamouse.me/js/script-wl33z0n6ocaypepiqrazthtivfrliqijej4rq8ek8gvrv1awftmgjuv8k4zc.min.js"></script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight').each(function(i, block) {
    var code = "";
    hljs.highlightAuto(block.innerText).value.split(/\r\n|\r|\n/).forEach(function(line) {
      code += "<span class=\"line\">" + line + "</span><br>";
    });
    if (code.length > 0) {
      block.innerHTML = code;  
    }
  });
  $('pre > code').each(function(i, block) {
    $(this).addClass('codeblock');
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/rastamouse.me\/2018\/03\/laps---part-1\/';
          
            this.page.identifier = '\/2018\/03\/laps---part-1\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'rastamouse';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  





    
  </body>
</html>

